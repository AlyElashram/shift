generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// AUTHENTICATION & USERS
// ============================================

enum UserRole {
  ADMIN
  SUPER_ADMIN
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      UserRole @default(ADMIN)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  statusChanges ShipmentStatusHistory[]
  shipmentsCreated Shipment[] @relation("CreatedBy")
}

// ============================================
// CUSTOMERS & LEADS
// ============================================

model Customer {
  id        String   @id @default(cuid())
  name      String
  email     String?
  phone     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  shipments Shipment[]
}

model Lead {
  id             String   @id @default(cuid())
  name           String
  email          String
  phone          String
  documentStatus String   // non-egyptian-passport, uae-eqama, none
  createdAt      DateTime @default(now())
  contacted      Boolean  @default(false)
}

// ============================================
// SHIPMENTS
// ============================================

model Shipment {
  id           String   @id @default(cuid())
  trackingId   String   @unique @default(cuid()) // Public tracking ID

  // Car Details
  manufacturer String
  model        String
  vin          String
  year         Int?
  color        String?
  pictures     String[] // Array of image URLs

  // Owner Details
  ownerName    String
  ownerEmail   String?
  ownerPhone   String?

  // Status
  currentStatusId String?
  currentStatus   ShipmentStatus? @relation(fields: [currentStatusId], references: [id])

  // Metadata
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  createdById  String?
  createdBy    User?    @relation("CreatedBy", fields: [createdById], references: [id])

  // Relations
  customer     Customer? @relation(fields: [customerId], references: [id])
  customerId   String?
  statusHistory ShipmentStatusHistory[]

  @@index([trackingId])
  @@index([vin])
}

// ============================================
// STATUS MANAGEMENT
// ============================================

model ShipmentStatus {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  order       Int      @default(0) // For ordering in UI
  isTransit   Boolean  @default(false) // Is this a "in transit" status?
  notifyEmail Boolean  @default(false) // Send email when shipment reaches this status
  color       String?  // Optional color for UI
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  shipments     Shipment[]
  statusHistory ShipmentStatusHistory[]
}

model ShipmentStatusHistory {
  id          String   @id @default(cuid())
  shipmentId  String
  shipment    Shipment @relation(fields: [shipmentId], references: [id], onDelete: Cascade)
  statusId    String
  status      ShipmentStatus @relation(fields: [statusId], references: [id])
  changedAt   DateTime @default(now())
  changedById String?
  changedBy   User?    @relation(fields: [changedById], references: [id])
  notes       String?

  @@index([shipmentId])
}

// ============================================
// TEMPLATES
// ============================================

enum TemplateType {
  CONTRACT
  BILL
  EMAIL
}

model Template {
  id        String       @id @default(cuid())
  name      String
  type      TemplateType
  content   String       @db.Text // JSON or HTML content with placeholders
  isDefault Boolean      @default(false)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
}

// ============================================
// SHOWCASE (Frontend car gallery)
// ============================================

model CarShowcase {
  id        String   @id @default(cuid())
  image     String   // Image URL
  model     String
  year      String
  origin    String
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
